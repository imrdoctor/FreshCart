import{c as I,r as a,C as R,W as q,b as p,j as e,_ as d}from"./index-D1X4h8q3.js";import{l as $}from"./Loader-DLhe4uCz.js";import{P as G}from"./ProductItem-Ma12OLge.js";import{u as K}from"./useQuery-BXsUSnvB.js";import{S as O}from"./index-DAujSm4j.js";function M(){const{productId:i}=I(),[y,n]=a.useState([]),[N,b]=a.useState(""),{addProductToCart:v}=a.useContext(R),[c,o]=a.useState(!1),[l,m]=a.useState(null),{wishList:f,removecruntid:x,removeItem:w,addtoWashList:P,addcruntid:u}=a.useContext(q),[_,C]=a.useState(!1),L=()=>p.get(`https://ecommerce.routemisr.com/api/v1/products/${i}`);a.useEffect(()=>{const t=f.some(r=>r._id===i);C(t)},[f,i]);const{data:s,error:S,isLoading:W,refetch:E}=K({queryKey:["productDetails",i],queryFn:L,select:t=>t==null?void 0:t.data.data});a.useEffect(()=>{i&&n([])},[i,E]),a.useEffect(()=>{s&&s.category&&k(s.category._id)},[s]);const k=async t=>{o(!0),m(t);try{const{data:r}=await p.get(`https://ecommerce.routemisr.com/api/v1/products?category=${t}`),A=r.data.filter(F=>F._id!==i);n(A),r.data.length>0&&b(r.data[0].category.name)}catch(r){console.error("Error fetching related products:",r)}finally{o(!1)}},h=async t=>{o(!0),m(t);try{const r=await v(t);o(!0),r&&r.status===200?d.success(r.data.message,{style:{background:"#22d210",color:"#fff"}}):d.error("Login First To Add Product To Cart",{style:{background:"#f15757",color:"#fff"}})}catch{d.error("An error occurred while adding product to cart. Please try again later.",{style:{background:"#f15757",color:"#fff"}})}finally{o(!1)}},g=t=>{P(t)},j=t=>{w(t)};if(W)return e.jsx($,{});if(S)return e.jsx("div",{className:"text-red-500 text-center mt-10",children:"Error loading product details."});const T={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row flex-col justify-center m-auto md:flex-row mt-16 mb-14",children:[e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(O,{...T,children:s==null?void 0:s.images.map((t,r)=>e.jsx("img",{className:"w-full object-cover",src:t,alt:(s==null?void 0:s.title)||"Product image"},r))})}),e.jsxs("div",{className:"w-full md:w-2/4 p-4 md:p-6",children:[e.jsx("h1",{className:"text-xl md:text-lg font-semibold text-gray-950 mb-4",children:s==null?void 0:s.title}),e.jsx("p",{className:"text-gray-400 font-light mb-4",children:s==null?void 0:s.description}),e.jsx("p",{className:"text-green-600 mb-3",children:s==null?void 0:s.category.name}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mt-1",children:[e.jsxs("span",{className:"text-lg",children:[s==null?void 0:s.price," EGP"]}),e.jsx("div",{className:"flex"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("span",{className:"flex items-center mt-2 md:mt-0",children:[s==null?void 0:s.ratingsAverage," ",e.jsx("i",{className:"fa fa-star text-yellow-300 ml-1"})]}),e.jsx("span",{className:"cursor-pointer",children:_?e.jsx("button",{disabled:x&&s._id===x,onClick:()=>j(s._id),className:"text-red-700",children:e.jsx("i",{className:"fa fa-heart text-red-600 hover:text-red-400 fa-xl"})}):e.jsx("button",{disabled:u&&s._id===u,onClick:()=>g(s._id),className:"text-gray-300",children:e.jsx("i",{className:"fa fa-heart text-gray-300 hover:text-red-600 fa-xl"})})})]})]}),e.jsx("button",{disabled:c&&s._id===l,onClick:()=>h(s._id),className:"transition-transform transform bg-green-300 hover:bg-green-400 font-bold text-white px-4 py-2 rounded w-full mt-4",children:c&&s._id===l?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin-pulse"})," ",e.jsx("span",{children:"loading"})]}):e.jsxs("span",{children:[e.jsx("i",{className:"fa-solid fa-cart-shopping mr-2"})," Add To Cart"]})})]})]}),e.jsxs("h2",{className:"text-xl font-semibold mb-4 text-center block",children:["Related Products Of ",e.jsx("p",{className:"text-green-600",children:N})]}),e.jsx("div",{className:"related-products mt-8",children:e.jsx("div",{className:"row",children:y.map(t=>e.jsx(G,{product:t,loading:c,cruntid:l,addToCart:h,AddWishList:()=>g(t._id),removewashList:()=>j(t._id)},t._id))})})]})}export{M as default};
